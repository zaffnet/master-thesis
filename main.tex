% !TeX TS-program = pdflatex
% !BIB TS-program = bibtex
% !TeX root = main.tex
\documentclass{ut-thesis}

\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc} % Recommended for modern font encoding and PDF copy-paste

% --- MATH & FONTS ---
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{xparse} % For creating new commands

% --- GRAPHICS & COLOR ---
% Load color early to prevent conflicts
\usepackage{graphicx}
\usepackage{xcolor}
\usepackage{adjustbox} % Depends on graphicx

% --- PAGE LAYOUT & SPACING ---
\usepackage{pdflscape} % For landscape pages
\usepackage{setspace}
\usepackage{ragged2e}
\usepackage{titlesec} % For customizing section headings

% --- TABLES ---
% Group all table-related packages together
\usepackage{array}
\usepackage{booktabs}
\usepackage{tabularx}
\usepackage{multirow}
\usepackage{makecell}
\usepackage[para,online,flushleft]{threeparttable}

% --- FLOATS, CAPTIONS, & LISTS ---
\usepackage{float}
\usepackage{caption}
\usepackage{subcaption} % Must be loaded AFTER caption
\usepackage{enumitem}
\usepackage{algorithm}
\usepackage{algpseudocode}

% --- CODE LISTINGS & BOXES ---
\usepackage{fancyvrb}
\usepackage{listings}
\usepackage[most]{tcolorbox}
\tcbuselibrary{listings} % Must be loaded AFTER tcolorbox and listings

% --- UTILITIES ---
\usepackage{scrextend} % For extra text formatting tools
\usepackage{textcase}
\usepackage{siunitx} % For typesetting units
\usepackage{lipsum} % For dummy text (can go anywhere)

% --- BIBLIOGRAPHY ---
\usepackage{natbib}

% --- HYPER-REFERENCING PACKAGES (LOAD LAST) ---
% This is the golden rule!
\usepackage[colorlinks=true, linkcolor=cyan, citecolor=cyan, urlcolor=cyan]{hyperref}
\usepackage{cleveref} % Must be loaded AFTER hyperref

% --- Bibliography Style ---
\bibliographystyle{acl_natbib}

% --- Custom Citation Commands ---
\renewcommand\cite{\citep}
\newcommand\shortcite{\citeyearpar}
\newcommand\newcite{\citet}
\newcommand{\citeposs}[1]{\citeauthor{#1}'s (\citeyear{#1})}
\newcommand\percent{\%}

% --- Cleveref Formatting ---
\crefformat{section}{\textbf{Section~#2#1#3}}
\crefformat{figure}{\textbf{Figure~#2#1#3}}
\crefformat{table}{\textbf{Table~#2#1#3}}
\crefformat{equation}{\textbf{(#2#1#3)}}

% --- Code Listing Style for Prompts ---
\lstdefinestyle{promptstyle}{
  language={},
  basicstyle=\ttfamily\small,
  breaklines=true,
  postbreak=\mbox{\textcolor{red}{$\hookrightarrow$}\space},
  showstringspaces=false,
  columns=fullflexible,
  keepspaces=true,
}

% --- Custom TColorBox for System Prompts ---
\NewDocumentCommand{\includesystemprompt}{ O{} m m }{%
  \begin{tcolorbox}[
    listing only,
    listing options={style=promptstyle},
    title=#2,
    colback=gray!10,
    colframe=gray!75!black,
    fonttitle=\bfseries,
    arc=2mm,
    boxrule=2pt,
    breakable=true,
    boxsep=1mm,
    #1
  ]
#3
  \end{tcolorbox}
}

% --- Layout and Formatting Adjustments ---
\setlength{\parskip}{0.75em}
\titlespacing*{\section}{0pt}{16pt}{0pt}
\titlespacing*{\subsection}{0pt}{8pt}{0pt}
\titlespacing*{\subsubsection}{0pt}{4pt}{0pt}
\setstretch{0.99}
\captionsetup{font=small, labelfont=bf}
\newcolumntype{Y}{>{\raggedright\arraybackslash}X} % Custom table column type

% --- Redefine \subsubsection to Color Specific Titles ---
\let\oldsubsubsection\subsubsection
\renewcommand{\subsubsection}[1]{%
  \ifboolexpr{
    test {\ifstrequal{#1}{Methodology}} or
    test {\ifstrequal{#1}{Evaluation}} or
    test {\ifstrequal{#1}{Results}} or
    test {\ifstrequal{#1}{Observations}}
  }
  {\oldsubsubsection{\textcolor{red}{#1}}}% If true, set color to red
  {\oldsubsubsection{#1}}% If false, use the default
}

% --- Thesis Information ---
\author{Zafarullah Mahmood}
\title{A Fully Generative Motivational Interviewing Chatbot for Moving Smokers Towards the Decision to Quit and LLM-Based Synthetic Smokers}
\degree{Master of Applied Science}
\department[]{Edward S. Rogers Sr. Department of Electrical \& Computer Engineering}
\gradyear{2025}

% --- Document Body ---
\begin{document}

  \frontmatter
    \maketitle
    \begin{abstract}
      \input{abstract}
    \end{abstract}
    \begin{dedication}
      \begin{flushright}
        \textit{To the children who aged too soon,\\
        and the futures that never were.}
      \end{flushright}
    \end{dedication}
    \begin{acknowledgements}
      \input{acknowledgements}
    \end{acknowledgements}
    \tableofcontents
    \listoftables
    \listoffigures

  \mainmatter
    \input{ch-intro}
    \input{ch-background}
    
    \input{ch-mibot}
    \input{ch-mibot-feasibility-study}
    \input{ch-mibot-eval}
    
    \input{ch-synthetic-smoker}
    \input{ch-synthetic-doppelganger}
    
    \input{ch-conclusion}

  \appendix
    \input{ap-code}
    \clearpage

  \backmatter
    \cleardoublepage
    \phantomsection
    \addcontentsline{toc}{chapter}{Bibliography}
    \bibliography{main}

\end{document}