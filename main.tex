% !TeX TS-program = pdflatex
% !BIB TS-program = biber
% !TeX root = main.tex
\documentclass{ut-thesis}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{xparse}
\usepackage{graphicx}
\usepackage{xcolor}
\usepackage{adjustbox}
\usepackage{pdflscape}
\usepackage{setspace}
\usepackage{ragged2e}
\usepackage{titlesec}
\usepackage{array}
\usepackage{booktabs}
\usepackage{tabularx}
\usepackage{multirow}
\usepackage{makecell}
\usepackage[para,online,flushleft]{threeparttable}
\usepackage{float}
\usepackage{caption}
\usepackage{subcaption}
\usepackage{enumitem}
\usepackage{algorithm}
\usepackage{algpseudocode}
\usepackage{fancyvrb}
\usepackage{listings}
\usepackage[most]{tcolorbox}
\tcbuselibrary{listings}
\usepackage{scrextend}
\usepackage{textcase}
\usepackage{siunitx}
\usepackage{lipsum}
\usepackage[english]{babel}
\usepackage{csquotes}
\usepackage[backend=biber,
            style=apa,
            sorting=nyt,
            maxbibnames=99,
            maxcitenames=2,
            mincitenames=1,
            giveninits=false,
            uniquelist=false,
            uniquename=false,
            defernumbers=true]{biblatex}
\usepackage[colorlinks=true, linkcolor=cyan, citecolor=cyan, urlcolor=cyan]{hyperref}
\usepackage{cleveref}

\DeclareFieldFormat{labelnumberwidth}{#1}
\setlength{\labelnumberwidth}{3em}
\defbibenvironment{bibliography}
  {\list
     {\printfield[labelnumberwidth]{labelnumber}}
     {\setlength{\labelwidth}{\labelnumberwidth}%
      \setlength{\leftmargin}{\labelwidth}%
      \setlength{\labelsep}{\biblabelsep}%
      \addtolength{\leftmargin}{\labelsep}%
      \setlength{\itemsep}{1.5em}%
      \setlength{\parsep}{0pt}%
      \renewcommand*{\makelabel}[1]{\hss[##1]}}}
  {\endlist}
  {\item}

\DeclareFieldFormat[article]{title}{#1}
\DeclareFieldFormat[article,book,booklet,conference,inbook,incollection,inproceedings,manual,mastersthesis,misc,phdthesis,proceedings,techreport,unpublished]{title}{#1}
\DeclareFieldFormat[article]{pages}{#1}
\DeclareFieldFormat{url}{\url{#1}}
\DeclareFieldFormat{doi}{\url{https://doi.org/#1}}
\DeclareFieldFormat{title}{%
  \iffieldundef{doi}
    {\iffieldundef{url}
      {#1}% 
      {\href{\thefield{url}}{#1}}}% Only URL exists
    {\href{https://doi.org/\thefield{doi}}{#1}}}

\DeclareFieldFormat[article,book,booklet,conference,inbook,incollection,inproceedings,manual,mastersthesis,misc,phdthesis,proceedings,techreport,unpublished]{title}{%
  \iffieldundef{doi}
    {\iffieldundef{url}
      {#1}%
      {\href{\thefield{url}}{#1\addperiod}}}%
    {\href{https://doi.org/\thefield{doi}}{#1\addperiod}}%
}
\DeclareFieldFormat{url}{} 
\DeclareFieldFormat{doi}{} 

\DeclareCiteCommand{\parencite}[\mkbibparens]
  {\usebibmacro{prenote}}
  {\usebibmacro{citeindex}%
   \printtext[bibhyperref]{\usebibmacro{cite}}}
  {\multicitedelim}
  {\usebibmacro{postnote}}


\DeclareCiteCommand{\textcite}
  {\usebibmacro{prenote}}
  {%
   \printtext{\bibhyperref{%
        \citeauthor{\thefield{entrykey}}\space%
        \mkbibparens{\citeyear{\thefield{entrykey}}}%
    }}}
  {\multicitedelim}
  {\usebibmacro{postnote}}


\newcommand\citep{\parencite}
\renewcommand\cite{\parencite}
\newcommand\citet{\textcite}
\setlength\bibitemsep{1em}
\addbibresource{main.bib}

\crefformat{section}{Section~#2#1#3}
\crefformat{figure}{Figure~#2#1#3}
\crefformat{table}{Table~#2#1#3}
\crefformat{equation}{(#2#1#3)}

\lstdefinestyle{promptstyle}{
  language={},
  basicstyle=\ttfamily\small,
  breaklines=true,
  postbreak=\mbox{\textcolor{red}{$\hookrightarrow$}\space},
  showstringspaces=false,
  columns=fullflexible,
  keepspaces=true,
}

\NewDocumentCommand{\includesystemprompt}{ O{} m m }{%
  \begin{tcolorbox}[
    listing only,
    listing options={style=promptstyle},
    title=#2,
    colback=gray!10,
    colframe=gray!75!black,
    fonttitle=\bfseries,
    arc=2mm,
    boxrule=2pt,
    breakable=true,
    boxsep=1mm,
    #1
  ]
#3
  \end{tcolorbox}
}

\setlength{\parskip}{0.75em}
\titlespacing*{\section}{0pt}{16pt}{0pt}
\titlespacing*{\subsection}{0pt}{8pt}{0pt}
\titlespacing*{\subsubsection}{0pt}{4pt}{0pt}
\setstretch{0.99}
\captionsetup{font=small, labelfont=bf}
\newcolumntype{Y}{>{\raggedright\arraybackslash}X}
\let\oldsubsubsection\subsubsection
\renewcommand{\subsubsection}[1]{%
  \ifboolexpr{
    test {\ifstrequal{#1}{Methodology}} or
    test {\ifstrequal{#1}{Evaluation}} or
    test {\ifstrequal{#1}{Results}} or
    test {\ifstrequal{#1}{Observations}}
  }
  {\oldsubsubsection{\textcolor{red}{#1}}}
  {\oldsubsubsection{#1}}
}


\author{Zafarullah Mahmood}
\title{A Fully Generative Motivational Interviewing Chatbot for Moving Smokers Towards the Decision to Quit and LLM-Based Synthetic Smokers}
\degree{Master of Applied Science}
\department[]{Edward S. Rogers Sr. Department of Electrical \& Computer Engineering}
\gradyear{2025}


\begin{document}

    \frontmatter
        \maketitle
        \begin{abstract}
            \input{abstract}
        \end{abstract}
        \begin{dedication}
            \begin{flushright}
                \textit{To the children who aged too soon,\\
                and the futures that never were.}
            \end{flushright}
        \end{dedication}
        \begin{acknowledgements}
            \input{acknowledgements}
        \end{acknowledgements}
        \tableofcontents
        \listoftables
        \listoffigures
    
    \mainmatter
        \input{ch-intro}
        \input{ch-background}
    
        \input{ch-mibot}
        \input{ch-mibot-feasibility-study}
        \input{ch-mibot-eval}
    
        \input{ch-synthetic-smoker}
        \input{ch-synthetic-doppelganger}
    
        \input{ch-conclusion}
    
    \addcontentsline{toc}{chapter}{Bibliography}
    \printbibliography

\end{document}