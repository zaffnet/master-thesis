% !TeX TS-program = pdflatex
% !BIB TS-program = biber
% !TeX root = main.tex
\documentclass{ut-thesis}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{lmodern} 
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{xparse}
\usepackage{graphicx}
\usepackage{adjustbox}
\usepackage{pdflscape}
\usepackage{setspace}
\usepackage{ragged2e}
\usepackage{titlesec}
\usepackage{array}
\usepackage{booktabs}
\usepackage{tabularx}
\usepackage{multirow}
\usepackage{makecell}
\usepackage{longtable}
\usepackage[para,online,flushleft]{threeparttable}
\usepackage{float}
\usepackage{caption}
\usepackage{subcaption}
\usepackage{enumitem}
\usepackage{colortbl}
\usepackage{algorithm}
\usepackage{algpseudocode}
\usepackage{fancyvrb}
\usepackage{listings}
\usepackage[svgnames]{xcolor}
\usepackage[most]{tcolorbox}
\tcbuselibrary{listings}
\usepackage{scrextend}
\usepackage{textcase}
\usepackage{siunitx}
\usepackage{lipsum}
\usepackage[english]{babel}
\usepackage{csquotes}
\usepackage[backend=biber,
            style=authoryear,
            dashed=false,
            sorting=nyt,
            maxbibnames=99,
            maxcitenames=2,
            mincitenames=1,
            giveninits=false,
            uniquelist=false,
            uniquename=false,
            defernumbers=true]{biblatex}
\usepackage[colorlinks=true, linkcolor=cyan, citecolor=cyan, urlcolor=cyan]{hyperref}
\usepackage{cleveref}
\usepackage{tgtermes}
\usepackage{xspace}  
\usepackage{titlesec}
\usepackage{parskip} % For space between paragraphs instead of indentation

\newcommand{\sysname}{{\textit{\textmd{\fontfamily{qtm}\selectfont MIBot}}}\xspace}

\newcommand{\sysnamewithv}{{\textit{\textmd{\fontfamily{qtm}\selectfont MIBot v6.3A}}}\xspace}

\newcommand{\oldsysname}{{\textit{\textmd{\fontfamily{qtm}\selectfont MIBot v5.2}}}\xspace}



\tcbuselibrary{skins}

\newtcolorbox{systembox}{
    enhanced,
    colback=red!15,
    colframe=red!50!black,
    boxrule=0.5pt,
    fonttitle=\bfseries,
    coltitle=White,
    sharp corners,
    title=System,
    attach boxed title to top right={yshift=-2.5mm, xshift=-3mm},
    boxed title style={
        sharp corners,
        size=small,
        colback=red!50!black,
        colframe=red!50!black,
    },
    pad at break=2mm,
    width=0.8\linewidth,
    before={\par\raggedleft},
    after={\par}
}

\newtcolorbox{researcherbox}{
    enhanced,
    colback=AliceBlue,
    colframe=SteelBlue,
    boxrule=0.5pt,
    fonttitle=\bfseries,
    coltitle=White,
    sharp corners,
    title=Researcher,
    attach boxed title to top left={yshift=-2.5mm, xshift=3mm},
    boxed title style={
        sharp corners,
        size=small,
        colback=SteelBlue,
        colframe=SteelBlue
    },
    pad at break=2mm,
    width=0.8\linewidth,
}

\newtcolorbox{clientbox}{
    enhanced,
    colback=Honeydew,
    colframe=SeaGreen,
    boxrule=0.5pt,
    fonttitle=\bfseries,
    coltitle=White,
    sharp corners,
    title=Client,
    attach boxed title to top right={yshift=-2.5mm, xshift=-3mm},
    boxed title style={
        sharp corners,
        size=small,
        colback=SeaGreen,
        colframe=SeaGreen
    },
    pad at break=2mm,
    width=0.8\linewidth,
    before={\par\raggedleft},
    after={\par},
}

\newtcolorbox{counsellorbox}{
    enhanced,
    colback=LightCyan,
    colframe=Teal,
    boxrule=0.5pt,
    fonttitle=\bfseries,
    coltitle=White,
    sharp corners,
    title=Counsellor,
    attach boxed title to top left={yshift=-2.5mm, xshift=3mm},
    boxed title style={
        sharp corners,
        size=small,
        colback=Teal,
        colframe=Teal
    },
    pad at break=2mm,
    width=0.8\linewidth,
}



\DeclareNameAlias{sortname}{given-family}
\DeclareNameAlias{default}{given-family}

\newcommand{\setupnormalchapters}{%
  \titleformat{\chapter}[display]
    {\normalfont\huge\bfseries}{\chaptertitlename\ \thechapter}{20pt}{\Huge}
}
\newcommand{\setupappendixchapters}{%
  \titleformat{\chapter}[hang]
    {\normalfont\huge\bfseries}
    {\thechapter.}
    {1em}
    {\large}
  \titlespacing*{\chapter}{0pt}{0ex plus 1ex minus .2ex}{-0.5ex plus .2ex}
}


\definecolor{codegray}{rgb}{0.95,0.95,0.95}
\definecolor{commentgreen}{rgb}{0.2,0.6,0.2}
\definecolor{keywordblue}{rgb}{0.13,0.13,1}
\definecolor{stringpurple}{rgb}{0.5,0,0.5}
\definecolor{commentgray}{RGB}{128,128,128}

% Define the listings style
\lstdefinestyle{dockerstyle}{
    backgroundcolor=\color{codegray},
    commentstyle=\color{commentgreen},
    keywordstyle=\color{keywordblue}\bfseries,
    stringstyle=\color{stringpurple},
    basicstyle=\footnotesize\ttfamily,
    breakatwhitespace=false,
    breaklines=true,
    captionpos=b,
    keepspaces=true,
    numbers=left,
    numbersep=10pt,
    numberstyle=\tiny\color{gray},
    showspaces=false,
    showstringspaces=false,
    showtabs=false,
    tabsize=2,
    frame=single,
    rulecolor=\color{black!30},
    frameround=tttt
}

% Set the defined style
\lstset{style=dockerstyle}


% 1. Define custom colors
\definecolor{codegray}{rgb}{0.95,0.95,0.95}
\definecolor{stringgreen}{rgb}{0.05,0.5,0.05}
\definecolor{keywordblue}{rgb}{0.13,0.13,1}
\definecolor{numberpurple}{rgb}{0.5,0,0.35}


\lstdefinelanguage{JSON}{
    keywords={true, false, null},
    keywordstyle=\color{keywordblue},
    stringstyle=\color{stringgreen},
    commentstyle=\color{commentgray},
    morestring=[s]{"}{"},
    morecomment=[l]{//},
    morecomment=[s]{/*}{*/},
    literate=
        *{0}{{{\color{black}0}}}1
         {1}{{{\color{black}1}}}1
         {2}{{{\color{black}2}}}1
         {3}{{{\color{black}3}}}1
         {4}{{{\color{black}4}}}1
         {5}{{{\color{black}5}}}1
         {6}{{{\color{black}6}}}1
         {7}{{{\color{black}7}}}1
         {8}{{{\color{black}8}}}1
         {9}{{{\color{black}9}}}1
}

% 2. Define the listings style for JSON
\lstdefinestyle{jsonstyle}{
    language=JSON, % Use the newly defined language
    backgroundcolor=\color{codegray},
    stringstyle=\color{stringgreen},      % Style for strings (keys and values)
    keywordstyle=\color{keywordblue},     % Style for true, false, null
    numberstyle=\tiny\color{numberpurple},% Style for numbers
    basicstyle=\footnotesize\ttfamily,
    breakatwhitespace=false,
    breaklines=true,
    captionpos=b,
    keepspaces=true,
    numbers=left,
    numbersep=10pt,
    numberstyle=\tiny\color{gray},
    showspaces=false,
    showstringspaces=false,
    showtabs=false,
    tabsize=2,
    frame=single,
    rulecolor=\color{black!30},
    frameround=tttt
}

% --- Track and format author names with selective bolding ---
\newcounter{mybibauthors}

% Custom name format for bibliography with selective bolding
\DeclareNameFormat{given-family}{%
  % Store the total author count when we start processing names
  \ifnumequal{\value{listcount}}{1}
    {\setcounter{mybibauthors}{\value{liststop}}}
    {}%
  % Now apply formatting based on total authors
  \ifnumgreater{\value{mybibauthors}}{2}
    {% More than 2 authors: bold ONLY first author's last name
     \ifnumequal{\value{listcount}}{1}
       {\namepartgiven\space\textbf{\namepartfamily}}% Bold first author only
       {\namepartgiven\space\namepartfamily}%         % No bold for others
    }
    {% 2 or fewer authors: bold ALL last names
     \namepartgiven\space\textbf{\namepartfamily}%
    }%
  \ifthenelse{\value{listcount}<\value{liststop}}
    {\addcomma\space}
    {}%
    \usebibmacro{name:andothers}%
}
\DeclareFieldFormat[article]{journaltitle}{\mkbibemph{#1}}
\DeclareFieldFormat{year}{\textbf{#1}}
\DeclareFieldFormat[article]{pages}{#1} 

\DeclareFieldFormat{labelnumberwidth}{#1}
\setlength{\labelnumberwidth}{3em}
\defbibenvironment{bibliography}
  {\list
     {\printfield[labelnumberwidth]{labelnumber}}
     {\setlength{\labelwidth}{\labelnumberwidth}%
      \setlength{\leftmargin}{\labelwidth}%
      \setlength{\labelsep}{\biblabelsep}%
      \addtolength{\leftmargin}{\labelsep}%
      \setlength{\itemsep}{1.5em}%
      \setlength{\parsep}{0pt}%
      \renewcommand*{\makelabel}[1]{\hss[##1]}}}
  {\endlist}
  {\item}

\DeclareFieldFormat[article]{title}{#1}
\DeclareFieldFormat[mastersthesis]{title}{#1}
\DeclareFieldFormat[phdthesis]{title}{#1}
\DeclareFieldFormat[thesis]{title}{#1}
\DeclareFieldFormat[article,book,booklet,conference,inbook,incollection,inproceedings,manual,mastersthesis,misc,phdthesis,proceedings,techreport,unpublished]{title}{#1}
\DeclareFieldFormat[article]{pages}{#1}
\DeclareFieldFormat{url}{\url{#1}}
\DeclareFieldFormat{doi}{\url{https://doi.org/#1}}
\DeclareFieldFormat{title}{%
  \iffieldundef{doi}
    {\iffieldundef{url}
      {#1}% 
      {\href{\thefield{url}}{#1}}}% Only URL exists
    {\href{https://doi.org/\thefield{doi}}{#1}}}

\DeclareFieldFormat[article,book,booklet,conference,inbook,incollection,inproceedings,manual,mastersthesis,misc,phdthesis,thesis,proceedings,techreport,unpublished]{title}{%
  \iffieldundef{doi}
    {\iffieldundef{url}
      {#1}%
      {\href{\thefield{url}}{#1\addperiod}}}%
    {\href{https://doi.org/\thefield{doi}}{#1\addperiod}}%
}
\DeclareFieldFormat{url}{} 
\DeclareFieldFormat{doi}{} 

\DeclareCiteCommand{\parencite}[\mkbibparens]
  {\usebibmacro{prenote}}
  {\usebibmacro{citeindex}%
   \printtext[bibhyperref]{\usebibmacro{cite}}}
  {\multicitedelim}
  {\usebibmacro{postnote}}


\DeclareCiteCommand{\textcite}
  {\usebibmacro{prenote}}
  {%
   \printtext{\bibhyperref{%
        \citeauthor{\thefield{entrykey}}\space%
        \mkbibparens{\citeyear{\thefield{entrykey}}}%
    }}}
  {\multicitedelim}
  {\usebibmacro{postnote}}


\newcommand\citep{\parencite}
\renewcommand\cite{\parencite}
\newcommand\citet{\textcite}
\setlength\bibitemsep{1em}


\addbibresource{main.bib}

\crefformat{section}{Section~#2#1#3}
\crefformat{figure}{Figure~#2#1#3}
\crefformat{table}{Table~#2#1#3}
\crefformat{equation}{(#2#1#3)}

\lstdefinestyle{promptstyle}{
  language={},
  basicstyle=\ttfamily\small,
  breaklines=true,
  postbreak=\mbox{\textcolor{red}{$\hookrightarrow$}\space},
  showstringspaces=false,
  columns=fullflexible,
  keepspaces=true,
}

\NewDocumentCommand{\includesystemprompt}{ O{} m m }{%
  \begin{tcolorbox}[
    listing only,
    listing options={style=promptstyle},
    title=#2,
    colback=gray!10,
    colframe=gray!75!black,
    fonttitle=\bfseries,
    arc=2mm,
    boxrule=2pt,
    breakable=true,
    boxsep=1mm,
    #1
  ]
#3
  \end{tcolorbox}
}

\setlength{\parskip}{0.75em}
\titlespacing*{\section}{0pt}{16pt}{0pt}
\titlespacing*{\subsection}{0pt}{8pt}{0pt}
\titlespacing*{\subsubsection}{0pt}{4pt}{0pt}
\setstretch{0.99}
\captionsetup{font=small, labelfont=bf}
\newcolumntype{Y}{>{\raggedright\arraybackslash}X}
\let\oldsubsubsection\subsubsection
\renewcommand{\subsubsection}[1]{%
  \ifboolexpr{
    test {\ifstrequal{#1}{Methodology}} or
    test {\ifstrequal{#1}{Evaluation}} or
    test {\ifstrequal{#1}{Results}} or
    test {\ifstrequal{#1}{Observations}}
  }
  {\oldsubsubsection{\textcolor{red}{#1}}}
  {\oldsubsubsection{#1}}
}


\author{Zafarullah Mahmood}
\title{A Fully Generative Motivational Interviewing Chatbot for Moving Smokers Towards the Decision to Quit and LLM-Based Synthetic Smokers}
\degree{Master of Applied Science}
\department[]{Edward S. Rogers Sr. Department of Electrical \& Computer Engineering}
\gradyear{2025}


\begin{document}

    \frontmatter
        \maketitle
        \begin{abstract}
            \input{abstract}
        \end{abstract}
        \begin{dedication}
            \begin{flushright}
                \textit{To the children who aged too soon,\\
                and the futures that never were.}
            \end{flushright}
        \end{dedication}
        \begin{acknowledgements}
            \input{acknowledgements}
        \end{acknowledgements}
        \tableofcontents
        \listoftables
        \listoffigures
    
    \mainmatter
        \input{ch-intro}
        \input{ch-background}
    
        \input{ch-mibot}
        \input{ch-mibot-feasibility-study}
        \input{ch-mibot-eval}
    
        \input{ch-synthetic-smoker}
        \input{ch-synthetic-doppelganger}
    
        \input{ch-conclusion}


\backmatter
    \addcontentsline{toc}{chapter}{Bibliography}
    \printbibliography
    \clearpage

    \appendix
    \input{app-mibot-prompts}
    \input{app-observer-prompts}
    \input{app-virtual-smoker-prompt}
    \input{app-mibot-history}
    \input{app-example-conversation}
    \input{app-readiness-rulers}
    \input{app-care-survey}
    \input{app-feedback}
    \input{app-automisc}
    \input{app-deployment-artifacts}
    \input{app-architecture-diagrams}
    \input{app-dataset}
    \input{app-consent}
    \input{app-doppelganger-prompts}
    \input{app-doppelganger-transcript}
    

\end{document}